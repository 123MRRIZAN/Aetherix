<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aetherix - FaceID</title>
<script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
<style>
body { font-family: Arial; background:#e0f7fa; color:#003366; margin:0; padding:0; text-align:center; }
header { background:#009688; color:white; padding:20px; }
nav { background:#004d40; display:flex; justify-content:center; }
nav a { color:white; padding:15px 25px; text-decoration:none; }
nav a:hover { background:#00796b; }
section { padding:20px; }
video { border:1px solid #004d40; margin-top:10px; }
p { font-size:16px; margin-top:15px; }
</style>
</head>
<body>
<header>
<h1><span>Aetherix</span> - Face ID</h1>
</header>
<nav>
<a href="Home.html">Home</a><a href="Carbon.html">Carbon Calculator</a><a href="LiveData.html">Live Data</a><a href="AISolutions.html">AI Solutions</a><a href="Personalize.html">Personalize</a><a href="Chat.html">Chat</a><a href="FaceID.html">Face ID</a><a href="News.html">News</a><a href="About.html">About</a><a href="Maths.html">Maths</a>
</nav>
<section>
<video id="video" width="320" height="240" autoplay muted></video>
<p id="result">Scanning for faces...</p>
</section>

<script>
// Load models
Promise.all([
  faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/weights'),
  faceapi.nets.faceLandmark68Net.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/weights'),
  faceapi.nets.faceRecognitionNet.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/weights')
]).then(startVideo);

const video = document.getElementById('video');

function startVideo(){
  navigator.mediaDevices.getUserMedia({ video:{} })
  .then(stream => video.srcObject = stream)
  .catch(err => console.error("Webcam error:", err));
}

video.addEventListener('play', async () => {
  const profiles = JSON.parse(localStorage.getItem('profiles')||"[]");
  if(profiles.length===0){ document.getElementById('result').innerText="No saved profiles."; return; }

  const labeledDescriptors = profiles.map(p => new faceapi.LabeledFaceDescriptors(p.name, [new Float32Array(p.descriptor)]));
  const faceMatcher = new faceapi.FaceMatcher(labeledDescriptors, 0.6);

  const canvas = faceapi.createCanvasFromMedia(video);
  document.body.append(canvas);
  const displaySize = { width: video.width, height: video.height };
  faceapi.matchDimensions(canvas, displaySize);

  setInterval(async () => {
    const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceDescriptors();
    const resizedDetections = faceapi.resizeResults(detections, displaySize);
    canvas.getContext('2d').clearRect(0,0,canvas.width,canvas.height);
    faceapi.draw.drawDetections(canvas, resizedDetections);

    if(detections.length > 0){
      const bestMatch = faceMatcher.findBestMatch(detections[0].descriptor);
      if(bestMatch.label !== "unknown"){
        const profile = profiles.find(p => p.name === bestMatch.label);
        document.getElementById('result').innerText = `Name: ${profile.name}, Age: ${profile.age}, Gender: ${profile.gender}`;
      } else {
        document.getElementById('result').innerText = "Face not recognized.";
      }
    } else {
      document.getElementById('result').innerText = "No face detected.";
    }
  }, 1000);
});
</script>
</body>
</html>
