<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Aetherix — Personalize</title>
<script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
<style>
body { font-family: Arial; background:#e0f7fa; color:#003366; margin:0; padding:0; text-align:center; }
header { background:#009688; color:white; padding:20px; }
nav { background:#004d40; display:flex; justify-content:center; flex-wrap:wrap; }
nav a { color:white; padding:10px 20px; margin:2px; text-decoration:none; }
nav a:hover, nav a.active { background:#00796b; }
section { padding:20px; }
input, select { padding:5px; margin:5px; }
button { padding:10px 20px; margin:5px; background:#009688; color:white; border:none; cursor:pointer; }
button:hover { background:#00796b; }
video, canvas { border:1px solid #004d40; margin-top:10px; }
.card { background:white; padding:15px; border-radius:10px; display:inline-block; margin-top:10px; }
.hidden { display:none; }
</style>
</head>
<body>

<header>
<h1>Aetherix — Personalize</h1>
</header>
<nav>
<a href="personalize.html" class="active">Personalize</a>
<a href="faceid.html">Face ID</a>
<a href="Carbon.html">Carbon Calculator</a>
<a href="LiveData.html">Live Data</a>
<a href="AISolutions.html">AI Solutions</a>
</nav>

<section>
<h2>Enter Your Details & Capture Face</h2>

<div class="card">
<input type="text" id="name" placeholder="Name"><br>
<input type="number" id="age" placeholder="Age"><br>
<input type="text" id="gender" placeholder="Gender"><br>

<video id="video" width="320" height="240" autoplay muted></video><br>
<button id="startCameraBtn">Start Camera</button>
<button id="captureBtn" disabled>Capture Face & Save Profile</button>
<button id="downloadBtn">Download Profile Card</button>

<canvas id="canvas" width="320" height="240" class="hidden"></canvas>
</div>
</section>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const startBtn = document.getElementById('startCameraBtn');
const captureBtn = document.getElementById('captureBtn');
const downloadBtn = document.getElementById('downloadBtn');

let capturedDescriptor = null;

// Load Face API models
Promise.all([
  faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/weights'),
  faceapi.nets.faceLandmark68Net.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/weights'),
  faceapi.nets.faceRecognitionNet.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/weights')
]).then(() => console.log("Models loaded"));

// Start camera
startBtn.addEventListener('click', () => {
  navigator.mediaDevices.getUserMedia({ video:{} })
  .then(stream => { video.srcObject = stream; captureBtn.disabled = false; })
  .catch(err => alert("Camera error: " + err));
});

// Capture face & save profile
captureBtn.addEventListener('click', async () => {
  const name = document.getElementById('name').value;
  const age = document.getElementById('age').value;
  const gender = document.getElementById('gender').value;
  if(!name || !age || !gender){ alert("Fill all fields!"); return; }

  const detection = await faceapi.detectSingleFace(video, new faceapi.TinyFaceDetectorOptions())
                     .withFaceLandmarks().withFaceDescriptor();
  if(!detection){ alert("No face detected!"); return; }
  capturedDescriptor = detection.descriptor;

  canvas.getContext('2d').drawImage(video,0,0,canvas.width,canvas.height);

  let profiles = JSON.parse(localStorage.getItem('profiles')||"[]");
  profiles.push({name, age, gender, descriptor:Array.from(capturedDescriptor), photo: canvas.toDataURL()});
  localStorage.setItem('profiles', JSON.stringify(profiles));
  alert("Profile saved successfully!");
});

// Download profile card
downloadBtn.addEventListener('click', () => {
  const ctx = canvas.getContext('2d');
  ctx.fillStyle = '#b2dfdb';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(video,0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#004d40';
  ctx.font = '16px Arial';
  ctx.fillText(`Name: ${document.getElementById('name').value}`, 10, 200);
  ctx.fillText(`Age: ${document.getElementById('age').value}`, 10, 220);
  ctx.fillText(`Gender: ${document.getElementById('gender').value}`, 10, 240);

  const link = document.createElement('a');
  link.download = 'profile_card.png';
  link.href = canvas.toDataURL();
  link.click();
});
</script>

</body>
</html>
