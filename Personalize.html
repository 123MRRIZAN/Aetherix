<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Aetherix — Personalize</title>
<script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
<style>
body { font-family: Arial; background:#e0f7fa; color:#003366; margin:0; padding:0; text-align:center; }
header { background:#009688; color:white; padding:20px; }
nav { background:#004d40; display:flex; justify-content:center; flex-wrap:wrap; }
nav a { color:white; padding:10px 20px; margin:2px; text-decoration:none; }
nav a:hover, nav a.active { background:#00796b; }
section { padding:20px; }
input { padding:5px; margin:5px; width:150px; }
button { padding:10px 20px; margin:5px; background:#009688; color:white; border:none; cursor:pointer; }
button:hover { background:#00796b; }
canvas { display:none; }
video { border:1px solid #004d40; margin-top:10px; }
</style>
</head>
<body>

<header>
<h1>Aetherix — Personalize</h1>
</header>

<nav>
<a href="personalize.html" class="active">Personalize</a>
<a href="faceid.html">Face ID</a>
<a href="Carbon.html">Carbon Calculator</a>
<a href="LiveData.html">Live Data</a>
<a href="AISolutions.html">AI Solutions</a>
</nav>

<section>
<h2>Enter Your Details & Capture Face</h2>
<label>Name: <input type="text" id="name" placeholder="Name"></label><br>
<label>Age: <input type="number" id="age" placeholder="Age"></label><br>
<label>Gender: <input type="text" id="gender" placeholder="Gender"></label><br>

<video id="video" width="320" height="240" autoplay muted></video><br>

<button id="startCameraBtn">Start Camera</button>
<button id="captureBtn" disabled>Capture Face</button>
<button id="saveProfileBtn">Save Profile</button>
<button id="downloadBtn">Download Profile Card</button>

<canvas id="canvas" width="320" height="240"></canvas>
</section>

<script>
// Load face-api models
Promise.all([
  faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/weights'),
  faceapi.nets.faceLandmark68Net.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/weights'),
  faceapi.nets.faceRecognitionNet.loadFromUri('https://cdn.jsdelivr.net/npm/face-api.js/weights')
]);

const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const startCameraBtn = document.getElementById('startCameraBtn');
const captureBtn = document.getElementById('captureBtn');
const saveProfileBtn = document.getElementById('saveProfileBtn');
const downloadBtn = document.getElementById('downloadBtn');

let capturedDescriptor = null;

// Start camera
startCameraBtn.addEventListener('click', async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
  video.srcObject = stream;
  captureBtn.disabled = false;
});

// Capture face descriptor
captureBtn.addEventListener('click', async () => {
  const detection = await faceapi.detectSingleFace(video, new faceapi.TinyFaceDetectorOptions())
                      .withFaceLandmarks().withFaceDescriptor();
  if(!detection) { alert("No face detected!"); return; }
  capturedDescriptor = detection.descriptor;
  alert("Face captured successfully!");
});

// Save profile
saveProfileBtn.addEventListener('click', () => {
  const name = document.getElementById('name').value;
  const age = document.getElementById('age').value;
  const gender = document.getElementById('gender').value;

  if(!name || !age || !gender || !capturedDescriptor){
    alert("Please fill all fields and capture your face.");
    return;
  }

  // Capture photo
  canvas.getContext('2d').drawImage(video,0,0,canvas.width,canvas.height);
  const photo = canvas.toDataURL('image/png');

  let profiles = JSON.parse(localStorage.getItem('profiles') || "[]");
  profiles.push({name, age, gender, photo, descriptor: Array.from(capturedDescriptor)});
  localStorage.setItem('profiles', JSON.stringify(profiles));
  alert("Profile saved!");
});

// Download profile card
downloadBtn.addEventListener('click', () => {
  canvas.getContext('2d').clearRect(0,0,canvas.width,canvas.height);
  canvas.getContext('2d').drawImage(video,0,0,canvas.width,canvas.height);
  const ctx = canvas.getContext('2d');
  ctx.fillStyle = '#004d40';
  ctx.font = '16px Arial';
  ctx.fillText(`Name: ${document.getElementById('name').value}`, 10, 200);
  ctx.fillText(`Age: ${document.getElementById('age').value}`, 10, 220);
  ctx.fillText(`Gender: ${document.getElementById('gender').value}`, 10, 240);

  const link = document.createElement('a');
  link.download = 'profile_card.png';
  link.href = canvas.toDataURL();
  link.click();
});
</script>
</body>
</html>
